<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Test idb.js</title>
   <style>
     body {
       font-family: Arial, sans-serif;
       max-width: 800px;
       margin: 50px auto;
       padding: 20px;
       background-color: #f5f5f5;
     }
     .result {
       background-color: white;
       padding: 15px;
       margin: 10px 0;
       border-radius: 5px;
       box-shadow: 0 2px 4px rgba(0,0,0,0.1);
     }
     .success {
       border-left: 4px solid #4caf50;
     }
     .error {
       border-left: 4px solid #f44336;
     }
     h1 {
       color: #333;
     }
     code {
       background-color: #f0f0f0;
       padding: 2px 6px;
       border-radius: 3px;
       font-family: 'Courier New', monospace;
     }
   </style>
</head>
<body>
   <h1>Testing idb.js Library</h1>
   <p>Open the browser console (F12) to see detailed logs.</p>
   <div id="results"></div>

   <script src="idb.js"></script>
   <script>
     const resultsDiv = document.getElementById('results');

     function addResult(message, isSuccess) {
       const div = document.createElement('div');
       div.className = 'result ' + (isSuccess ? 'success' : 'error');
       div.textContent = message;
       resultsDiv.appendChild(div);
     }

     async function test() {
       try {
         // Test 1: Open database
         addResult('Test 1: Opening database...', true);
         const db = await idb.openCostsDB("costsdb", 1);

         if (db) {
           console.log("Database opened successfully:", db);
           addResult('✓ Test 1 PASSED: Database opened successfully', true);
         } else {
           addResult('✗ Test 1 FAILED: Database is null', false);
           return;
         }

         // Test 2: Add first cost item
         addResult('Test 2: Adding first cost item...', true);
         const result1 = await db.addCost({
           sum: 200,
           currency: "USD",
           category: "FOOD",
           description: "pizza"
         });

         if (result1) {
           console.log("First cost item added:", result1);
           addResult('✓ Test 2 PASSED: First cost item added successfully', true);
           addResult('  Details: 200 USD - FOOD - pizza', true);
         } else {
           addResult('✗ Test 2 FAILED: Failed to add first cost item', false);
         }

         // Test 3: Add second cost item
         addResult('Test 3: Adding second cost item...', true);
         const result2 = await db.addCost({
           sum: 400,
           currency: "USD",
           category: "CAR",
           description: "fuel"
         });

         if (result2) {
           console.log("Second cost item added:", result2);
           addResult('✓ Test 3 PASSED: Second cost item added successfully', true);
           addResult('  Details: 400 USD - CAR - fuel', true);
         } else {
           addResult('✗ Test 3 FAILED: Failed to add second cost item', false);
         }

         // Test 4: Get report for current month
         addResult('Test 4: Getting report for current month...', true);
         const now = new Date();
         const currentYear = now.getFullYear();
         const currentMonth = now.getMonth() + 1;

         const report = await db.getReport(currentYear, currentMonth, "USD");

         if (report) {
           console.log("Report retrieved:", report);
           addResult('✓ Test 4 PASSED: Report retrieved successfully', true);
           addResult(`  Year: ${report.year}, Month: ${report.month}`, true);
           addResult(`  Total costs: ${report.costs.length}`, true);
           addResult(`  Total amount: ${report.total.total} ${report.total.currency}`, true);
         } else {
           addResult('✗ Test 4 FAILED: Failed to retrieve report', false);
         }

         addResult('=== All tests completed ===', true);

       } catch (error) {
         console.error("Test error:", error);
         addResult('✗ ERROR: ' + error.message, false);
       }
     }

     // Run tests when page loads
     test();
   </script>
</body>
</html>
